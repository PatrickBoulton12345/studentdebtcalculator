<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Loan Calculator | LFG UK</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'lfg-black': '#000000',
            'lfg-orange': '#FE5500',
            'lfg-yellow': '#EE9944',
            'lfg-blue': '#79CAC4',
            'lfg-cream': '#EBE3D0',
          },
          fontFamily: {
            'dm': ['DM Sans', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    body { margin: 0; padding: 0; background-color: #EBE3D0; min-height: 100vh; font-family: 'DM Sans', sans-serif; }
    input[type="range"] { -webkit-appearance: none; appearance: none; height: 8px; background: #000000; border-radius: 4px; outline: none; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 24px; height: 24px; background: #FE5500; border-radius: 50%; cursor: pointer; border: 3px solid #000000; }
    input[type="number"] { -moz-appearance: textfield; }
    input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .card { background: white; border: 2px solid #000000; border-radius: 16px; }
    /* Header styles */
    .header-nav a { transition: opacity 0.2s; }
    .mobile-menu {
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    .mobile-menu.open {
      display: block;
      opacity: 1;
    }
    /* Newsletter form */
    .nl-field input { height: 36px; width: 100%; border-radius: 6px; border: 1px solid #d1d5db; background: transparent; padding: 4px 12px; font-size: 16px; font-family: inherit; box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05); outline: none; transition: border-color 0.2s, box-shadow 0.2s; }
    .nl-field input:focus { border-color: #fe5500; box-shadow: 0 0 0 3px rgba(254,85,0,0.1); }
    .nl-field input.nl-error { border-color: #dc2626; }
    .nl-error-msg { color: #dc2626; font-size: 14px; display: none; }
    .nl-error-msg.show { display: block; }
    .nl-submit-error { background: #fef2f2; border: 1px solid #fecaca; color: #991b1b; font-size: 14px; padding: 12px; border-radius: 6px; display: none; }
    .nl-submit-error.show { display: block; }
    .nl-btn { background: black; border-top: 2px solid #fe5500; border-bottom: 6px solid #fe5500; border-left: 2px solid #fe5500; border-right: 6px solid #fe5500; cursor: pointer; color: white; border-radius: 8px; padding: 10px 24px; font-weight: bold; width: 100%; font-size: 16px; font-family: inherit; transition: all 0.2s; }
    .nl-btn:hover:not(:disabled) { background: #fe5500; border-top: 2px solid black; border-bottom: 6px solid black; border-left: 2px solid black; border-right: 6px solid black; color: black; }
    .nl-btn:disabled { opacity: 0.7; cursor: not-allowed; }
    .nl-modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
    .nl-modal-overlay.show { display: flex; }
    .nl-donate-btn { background: #fe5500; color: black; font-weight: bold; padding: 8px 24px; border-radius: 8px; text-decoration: none; border: 2px solid black; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: inline-block; font-size: 17px; transition: background 0.2s; }
    .nl-donate-btn:hover { background: #EE9944; }
  </style>
</head>
<body class="text-lfg-black font-dm">

  <!-- Header -->
  <header class="bg-lfg-blue border-b-4 border-lfg-black">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <!-- Logo (Desktop only - left aligned) -->
        <a href="https://lookingforgrowth.uk" class="header-nav hidden lg:block">
          <span class="text-2xl font-black text-lfg-black">LFG</span>
        </a>

        <!-- Mobile: Centered Logo -->
        <a href="https://lookingforgrowth.uk" class="lg:hidden absolute left-1/2 -translate-x-1/2">
          <span class="text-2xl font-black text-lfg-black">LFG</span>
        </a>

        <!-- Spacer for mobile to push hamburger right -->
        <div class="lg:hidden w-6"></div>

        <!-- Desktop Navigation -->
        <nav class="hidden lg:flex items-center gap-6 header-nav">
          <a href="https://dashboards.lookingforgrowth.uk/youth-unemployment-dashboard.html" class="text-sm font-medium text-lfg-black hover:opacity-70">Youth Unemployment</a>
          <a href="https://dashboards.lookingforgrowth.uk/dashboards/opinion-tracker/" class="text-sm font-medium text-lfg-black hover:opacity-70">Opinion Tracker</a>
          <a href="https://dashboards.lookingforgrowth.uk/dashboards/energy-costs/" class="text-sm font-medium text-lfg-black hover:opacity-70">Energy Costs</a>
          <a href="https://dashboards.lookingforgrowth.uk/dashboards/state-of-the-nation/" class="text-sm font-medium text-lfg-black hover:opacity-70">State of the Nation</a>
          <a href="https://dashboards.lookingforgrowth.uk/dashboards/no-more-delays/" class="text-sm font-medium text-lfg-black hover:opacity-70">No More Delays</a>
          <a href="https://dashboards.lookingforgrowth.uk/dashboards/planning-applications/ongoing-applications/" class="text-sm font-medium text-lfg-black hover:opacity-70">Planning Applications</a>
          <a href="https://dashboards.lookingforgrowth.uk/dirtydashboard/" class="text-sm font-medium text-lfg-black hover:opacity-70">Dirty Dashboard</a>
          <a href="https://lookingforgrowth.uk/merch" class="text-sm font-medium text-lfg-black hover:opacity-70">Merch</a>
          <a href="https://lookingforgrowth.uk/donate" class="text-sm font-medium text-lfg-black border-2 border-lfg-black px-4 py-1.5 rounded-full hover:bg-lfg-black hover:text-white transition-colors">donate</a>
        </nav>

        <!-- Mobile Menu Button -->
        <button class="lg:hidden p-2" onclick="toggleMobileMenu()" id="menuButton">
          <svg class="w-6 h-6 text-lfg-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu fixed inset-0 z-50 lg:hidden" id="mobileMenu">
    <!-- Header part with teal background -->
    <div class="bg-lfg-blue border-b-4 border-lfg-black px-4 py-3">
      <div class="flex items-center justify-between relative">
        <div class="w-6"></div> <!-- Spacer -->
        <span class="text-2xl font-black text-lfg-black">LFG</span>
        <button class="p-2" onclick="toggleMobileMenu()">
          <svg class="w-6 h-6 text-lfg-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Menu content with white background -->
    <div class="bg-white h-full overflow-y-auto">
      <nav class="flex flex-col p-6">
        <a href="https://dashboards.lookingforgrowth.uk/youth-unemployment-dashboard.html" class="text-xl font-bold text-lfg-black py-3 hover:opacity-70">Youth Unemployment</a>
        <a href="https://dashboards.lookingforgrowth.uk/dashboards/opinion-tracker/" class="text-xl font-bold text-lfg-black py-3 hover:opacity-70">Opinion Tracker</a>
        <a href="https://dashboards.lookingforgrowth.uk/dashboards/energy-costs/" class="text-xl font-bold text-lfg-black py-3 hover:opacity-70">Energy Costs</a>
        <a href="https://dashboards.lookingforgrowth.uk/dashboards/state-of-the-nation/" class="text-xl font-bold text-lfg-black py-3 hover:opacity-70">State of the Nation</a>
        <a href="https://dashboards.lookingforgrowth.uk/dashboards/no-more-delays/" class="text-xl font-bold text-lfg-black py-3 hover:opacity-70">No More Delays</a>
        <a href="https://dashboards.lookingforgrowth.uk/dashboards/planning-applications/ongoing-applications/" class="text-xl font-bold text-lfg-black py-3 hover:opacity-70">Planning Applications</a>
        <a href="https://dashboards.lookingforgrowth.uk/dirtydashboard/" class="text-xl font-bold text-lfg-black py-3 hover:opacity-70">Dirty Dashboard</a>
      </nav>

      <!-- Bottom actions -->
      <div class="border-t border-gray-200 p-6 mt-auto">
        <a href="https://lookingforgrowth.uk/donate" class="flex items-center gap-2 text-xl font-bold text-lfg-black py-3 underline hover:opacity-70">
          donate <span>→</span>
        </a>
        <a href="https://lookingforgrowth.uk/merch" class="flex items-center gap-2 text-xl font-bold text-lfg-black py-3 underline hover:opacity-70">
          buy our merch <span>→</span>
        </a>
      </div>
    </div>
  </div>

  <div class="p-4 md:p-8">

  <!-- Selection Menu -->
  <div id="selectionMenu" class="max-w-2xl mx-auto">
    <div class="text-center mb-8">
      <h1 class="text-4xl md:text-5xl font-black text-lfg-black mb-2">Student Loan Calculator</h1>
    </div>

    <!-- Plan Selection Box -->
    <div class="card p-8 mb-6">
      <h2 class="text-2xl font-black text-center mb-8">Select your student loan plan</h2>

      <!-- Plan Buttons -->
      <div class="bg-lfg-cream rounded-2xl p-6 border-2 border-lfg-black">
        <div class="grid md:grid-cols-2 gap-4">
          <button onclick="selectPlan('plan2')" class="bg-lfg-orange hover:bg-lfg-orange/90 text-white font-black text-xl py-6 px-8 rounded-xl border-2 border-lfg-black transition-all hover:scale-105 hover:shadow-lg">
            Plan 2
          </button>
          <button onclick="selectPlan('plan5')" class="bg-lfg-orange hover:bg-lfg-orange/90 text-white font-black text-xl py-6 px-8 rounded-xl border-2 border-lfg-black transition-all hover:scale-105 hover:shadow-lg">
            Plan 5
          </button>
        </div>
      </div>

      <!-- OR Divider -->
      <div class="flex items-center my-8">
        <div class="flex-1 h-0.5 bg-lfg-black/20"></div>
        <span class="px-6 text-lg font-black text-lfg-black/50">OR</span>
        <div class="flex-1 h-0.5 bg-lfg-black/20"></div>
      </div>

      <!-- Date Selection -->
      <div class="bg-lfg-cream rounded-2xl p-6 border-2 border-lfg-black">
        <h3 class="text-lg font-bold text-center mb-4">When did you start your undergraduate degree?</h3>
        <div class="grid md:grid-cols-2 gap-4">
          <button onclick="selectPlan('plan2')" class="bg-lfg-orange hover:bg-lfg-orange/90 text-white font-bold text-lg py-5 px-6 rounded-xl border-2 border-lfg-black transition-all hover:scale-105 hover:shadow-lg">
            <p class="text-xl font-black">Before August 2023</p>
            <p class="text-sm font-medium mt-2 opacity-90">September 2012 → July 2023</p>
          </button>
          <button onclick="selectPlan('plan5')" class="bg-lfg-orange hover:bg-lfg-orange/90 text-white font-bold text-lg py-5 px-6 rounded-xl border-2 border-lfg-black transition-all hover:scale-105 hover:shadow-lg">
            <p class="text-xl font-black">After August 2023</p>
            <p class="text-sm font-medium mt-2 opacity-90">September 2023 onwards</p>
          </button>
        </div>
      </div>

    </div>
  </div>

  <!-- Plan 2 Calculator (existing content) -->
  <div id="plan2Content" class="max-w-5xl mx-auto" style="display: none;">
    <div class="text-center mb-8">
      <button onclick="showMenu()" class="mb-4 text-lfg-orange hover:text-lfg-orange/80 font-bold text-sm flex items-center gap-2 mx-auto">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        Back to plan selection
      </button>
      <h1 class="text-4xl md:text-5xl font-black text-lfg-black mb-2">Student Loan Calculator</h1>
    </div>

    <!-- Your Details Input -->
    <div class="card p-6 mb-6">
      <h2 class="text-xl font-bold mb-6">Your Details</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm text-lfg-black/70 mb-2 font-medium">Your Annual Salary</label>
          <div class="flex gap-4 items-center">
            <input type="range" id="salarySlider" min="20000" max="80000" step="500" value="32347" class="flex-1" />
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-lfg-black/50">£</span>
              <input type="number" id="salaryInput" value="32347" class="w-32 bg-white border-2 border-lfg-black rounded-xl pl-7 pr-3 py-2 text-lfg-black text-right font-bold" />
            </div>
          </div>
          <p class="text-xs text-lfg-black/50 mt-2">Median for 22-29 year olds: £32,347 (<a href="https://www.ons.gov.uk/employmentandlabourmarket/peopleinwork/earningsandworkinghours/datasets/ashe1997to2015selectedestimates" target="_blank" class="underline hover:text-lfg-orange">ONS Data</a>)</p>
        </div>
        <div>
          <label class="block text-sm text-lfg-black/70 mb-2 font-medium">Outstanding Loan Balance</label>
          <div class="flex gap-4 items-center">
            <input type="range" id="loanSlider" min="0" max="100000" step="1000" value="53000" class="flex-1" />
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-lfg-black/50">£</span>
              <input type="number" id="loanInput" value="53000" class="w-32 bg-white border-2 border-lfg-black rounded-xl pl-7 pr-3 py-2 text-lfg-black text-right font-bold" />
            </div>
          </div>
          <p class="text-xs text-lfg-black/50 mt-2">Average balance: <a href="https://commonslibrary.parliament.uk/research-briefings/sn01079/#:~:text=The%20average%20debt%20among%20borrowers%20who%20finished%20their%20course%20in%202024%20was%20%C2%A353%2C000%20when%20they%20first%20became%20liable%20to%20repay%20this%20debt%20(April%202025" target="_blank" class="underline hover:text-lfg-orange">£53,000</a></p>
        </div>
      </div>
    </div>

    <!-- Your Monthly Contributions -->
    <div class="card p-6 mb-6">
      <h2 class="text-xl font-bold mb-6">Your Monthly Breakdown</h2>
      <div class="grid md:grid-cols-3 gap-4 mb-6">
        <div class="bg-lfg-blue/30 rounded-xl p-4 border-2 border-lfg-black">
          <p class="text-sm text-lfg-black/70 mb-1 font-medium">Monthly Repayment</p>
          <p class="text-2xl font-black text-lfg-black" id="monthlyRepayment">£37.22</p>
          <p class="text-xs text-lfg-black/50 mt-1">Deducted from your salary</p>
          <p class="text-xs text-lfg-black/50">9% over £28,470/year</p>
        </div>
        <div class="bg-lfg-orange/20 rounded-xl p-4 border-2 border-lfg-black">
          <p class="text-sm text-lfg-black/70 mb-1 font-medium">Monthly Interest Added</p>
          <p class="text-2xl font-black text-lfg-orange" id="monthlyInterest">£141.33</p>
          <p class="text-xs text-lfg-black/50 mt-1">Added to your balance</p>
          <p class="text-xs text-lfg-black/50" id="interestRateLabel">Interest rate: 3.2%</p>
        </div>
        <div class="bg-lfg-cream rounded-xl p-4 border-2 border-lfg-black">
          <p class="text-sm text-lfg-black/70 mb-1 font-medium">Net Monthly Change</p>
          <p class="text-2xl font-black" id="netChange">+£104.11</p>
          <p class="text-xs text-lfg-black/50 mt-1" id="netChangeLabel">Debt increasing</p>
        </div>
      </div>

      <!-- Interest Rate Explanation -->
      <div class="bg-lfg-cream/50 rounded-xl p-4 border-2 border-lfg-black/20 mb-6">
        <h4 class="font-bold text-sm mb-2">How Your Interest Rate is Calculated</h4>
        <div class="grid md:grid-cols-3 gap-4 text-sm">
          <div><p class="text-lfg-black/60">Earning ≤ £28,470</p><p class="font-bold">3.2% (RPI)</p></div>
          <div><p class="text-lfg-black/60">Earning £28,471 - £51,245</p><p class="font-bold">3.2% → 6.2% (scaled)</p></div>
          <div><p class="text-lfg-black/60">Earning ≥ £51,245</p><p class="font-bold">6.2% (RPI + 3%)</p></div>
        </div>
        <div class="mt-3 pt-3 border-t border-lfg-black/10">
          <p class="text-xs text-lfg-black/60"><strong>Your rate:</strong> <span id="interestRateExplanation">At £32,347, you're between the thresholds, so your rate is 3.82%</span></p>
        </div>
      </div>

      <!-- Monthly Bar Chart -->
      <div class="bg-lfg-cream/50 rounded-xl p-4 border-2 border-lfg-black/20">
        <h3 class="text-lg font-bold mb-4">Monthly: Your Repayment vs Interest Added</h3>
        <div style="height: 250px; position: relative;"><canvas id="barChart"></canvas></div>
      </div>

      <!-- Warning/Success messages -->
      <div class="mt-4 p-4 bg-lfg-orange/20 border-2 border-lfg-orange rounded-xl flex items-start gap-3" id="warningBox">
        <svg class="w-5 h-5 text-lfg-orange flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path></svg>
        <div><p class="font-bold text-lfg-orange">Your loan balance is growing</p><p class="text-sm text-lfg-black/70 mt-1" id="warningText">At your current salary, the interest added exceeds your repayments.</p></div>
      </div>
      <div class="mt-4 p-4 bg-lfg-blue/30 border-2 border-lfg-blue rounded-xl flex items-start gap-3" id="successBox" style="display: none;">
        <svg class="w-5 h-5 text-lfg-black flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
        <div><p class="font-bold text-lfg-black">Your loan balance is decreasing!</p><p class="text-sm text-lfg-black/70 mt-1" id="successText">Your repayments exceed the interest being added.</p></div>
      </div>
    </div>

    <!-- Share Your Results Section -->
    <div class="card p-6 mb-6">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-bold">Share your results</h2>
          <p class="text-lfg-black/60">Let others know how student loans really work</p>
        </div>
        <button onclick="shareOnX('plan2')" class="bg-lfg-black hover:bg-lfg-black/80 text-white font-bold py-3 px-6 rounded-xl inline-flex items-center gap-3 transition-all hover:scale-105">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
          Share on X
        </button>
      </div>

      <!-- Follow Us -->
      <div class="border-t border-lfg-black/20 mt-6 pt-6">
        <h3 class="text-center font-bold text-lg mb-4">Follow us</h3>
        <div class="flex justify-center gap-4">
          <a href="https://x.com/lfg_uk" target="_blank" class="bg-lfg-black hover:bg-lfg-black/80 text-white font-bold py-3 px-6 rounded-xl inline-flex items-center gap-3 transition-all hover:scale-105 border-2 border-lfg-black">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            X / Twitter
          </a>
          <a href="https://www.instagram.com/lookingforgrowthuk/" target="_blank" class="bg-gradient-to-r from-purple-500 via-pink-500 to-orange-400 hover:opacity-90 text-white font-bold py-3 px-6 rounded-xl inline-flex items-center gap-3 transition-all hover:scale-105">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
            Instagram
          </a>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="text-center mt-8 text-sm text-lfg-black/50">
      <p>Student loan thresholds and rates from gov.uk. Salary data from <a href="https://www.ons.gov.uk/employmentandlabourmarket/peopleinwork/earningsandworkinghours/datasets/ashe1997to2015selectedestimates" target="_blank" class="underline hover:text-lfg-orange">ONS Data</a>.</p>
      <p class="mt-2 font-bold text-lfg-orange">Built by LFG</p>
    </div>
  </div>

  <!-- Plan 5 Content -->
  <div id="plan5Content" class="max-w-5xl mx-auto" style="display: none;">
    <div class="text-center mb-8">
      <button onclick="showMenu()" class="mb-4 text-lfg-orange hover:text-lfg-orange/80 font-bold text-sm flex items-center gap-2 mx-auto">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        Back to plan selection
      </button>
      <h1 class="text-4xl md:text-5xl font-black text-lfg-black mb-2">Student Loan Calculator</h1>
    </div>

    <!-- Your Details Input -->
    <div class="card p-6 mb-6">
      <h2 class="text-xl font-bold mb-6">Your Details</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm text-lfg-black/70 mb-2 font-medium">Your Annual Salary</label>
          <div class="flex gap-4 items-center">
            <input type="range" id="p5-salarySlider" min="20000" max="80000" step="500" value="32347" class="flex-1" />
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-lfg-black/50">£</span>
              <input type="number" id="p5-salaryInput" value="32347" class="w-32 bg-white border-2 border-lfg-black rounded-xl pl-7 pr-3 py-2 text-lfg-black text-right font-bold" />
            </div>
          </div>
          <p class="text-xs text-lfg-black/50 mt-2">Median for 22-29 year olds: £32,347 (<a href="https://www.ons.gov.uk/employmentandlabourmarket/peopleinwork/earningsandworkinghours/datasets/ashe1997to2015selectedestimates" target="_blank" class="underline hover:text-lfg-orange">ONS Data</a>)</p>
        </div>
        <div>
          <label class="block text-sm text-lfg-black/70 mb-2 font-medium">Outstanding Loan Balance</label>
          <div class="flex gap-4 items-center">
            <input type="range" id="p5-loanSlider" min="0" max="100000" step="1000" value="53000" class="flex-1" />
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-lfg-black/50">£</span>
              <input type="number" id="p5-loanInput" value="53000" class="w-32 bg-white border-2 border-lfg-black rounded-xl pl-7 pr-3 py-2 text-lfg-black text-right font-bold" />
            </div>
          </div>
          <p class="text-xs text-lfg-black/50 mt-2">Average balance: <a href="https://commonslibrary.parliament.uk/research-briefings/sn01079/#:~:text=The%20average%20debt%20among%20borrowers%20who%20finished%20their%20course%20in%202024%20was%20%C2%A353%2C000%20when%20they%20first%20became%20liable%20to%20repay%20this%20debt%20(April%202025" target="_blank" class="underline hover:text-lfg-orange">£53,000</a></p>
        </div>
      </div>
    </div>

    <!-- Your Monthly Contributions -->
    <div class="card p-6 mb-6">
      <h2 class="text-xl font-bold mb-6">Your Monthly Breakdown</h2>
      <div class="grid md:grid-cols-3 gap-4 mb-6">
        <div class="bg-lfg-blue/30 rounded-xl p-4 border-2 border-lfg-black">
          <p class="text-sm text-lfg-black/70 mb-1 font-medium">Monthly Repayment</p>
          <p class="text-2xl font-black text-lfg-black" id="p5-monthlyRepayment">£65.22</p>
          <p class="text-xs text-lfg-black/50 mt-1">Deducted from your salary</p>
          <p class="text-xs text-lfg-black/50">9% over £25,000/year</p>
        </div>
        <div class="bg-lfg-orange/20 rounded-xl p-4 border-2 border-lfg-black">
          <p class="text-sm text-lfg-black/70 mb-1 font-medium">Monthly Interest Added</p>
          <p class="text-2xl font-black text-lfg-orange" id="p5-monthlyInterest">£141.33</p>
          <p class="text-xs text-lfg-black/50 mt-1">Added to your balance</p>
          <p class="text-xs text-lfg-black/50">Interest rate: 3.2% (fixed)</p>
        </div>
        <div class="bg-lfg-cream rounded-xl p-4 border-2 border-lfg-black">
          <p class="text-sm text-lfg-black/70 mb-1 font-medium">Net Monthly Change</p>
          <p class="text-2xl font-black" id="p5-netChange">+£76.11</p>
          <p class="text-xs text-lfg-black/50 mt-1" id="p5-netChangeLabel">Debt increasing</p>
        </div>
      </div>

      <!-- Interest Rate Explanation -->
      <div class="bg-lfg-cream/50 rounded-xl p-4 border-2 border-lfg-black/20 mb-6">
        <h4 class="font-bold text-sm mb-2">How Plan 5 Interest Works</h4>
        <div class="text-sm">
          <p class="text-lfg-black/60">Plan 5 has a <strong>fixed interest rate of 3.2% (RPI)</strong> regardless of your income.</p>
        </div>
      </div>

      <!-- Monthly Bar Chart -->
      <div class="bg-lfg-cream/50 rounded-xl p-4 border-2 border-lfg-black/20">
        <h3 class="text-lg font-bold mb-4">Monthly: Your Repayment vs Interest Added</h3>
        <div style="height: 250px; position: relative;"><canvas id="p5-barChart"></canvas></div>
      </div>

      <!-- Warning/Success messages -->
      <div class="mt-4 p-4 bg-lfg-orange/20 border-2 border-lfg-orange rounded-xl flex items-start gap-3" id="p5-warningBox">
        <svg class="w-5 h-5 text-lfg-orange flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path></svg>
        <div><p class="font-bold text-lfg-orange">Your loan balance is growing</p><p class="text-sm text-lfg-black/70 mt-1" id="p5-warningText">At your current salary, the interest added exceeds your repayments.</p></div>
      </div>
      <div class="mt-4 p-4 bg-lfg-blue/30 border-2 border-lfg-blue rounded-xl flex items-start gap-3" id="p5-successBox" style="display: none;">
        <svg class="w-5 h-5 text-lfg-black flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
        <div><p class="font-bold text-lfg-black">Your loan balance is decreasing!</p><p class="text-sm text-lfg-black/70 mt-1" id="p5-successText">Your repayments exceed the interest being added.</p></div>
      </div>
    </div>

    <!-- Share Your Results Section -->
    <div class="card p-6 mb-6">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-bold">Share your results</h2>
          <p class="text-lfg-black/60">Let others know how student loans really work</p>
        </div>
        <button onclick="shareOnX('plan5')" class="bg-lfg-black hover:bg-lfg-black/80 text-white font-bold py-3 px-6 rounded-xl inline-flex items-center gap-3 transition-all hover:scale-105">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
          Share on X
        </button>
      </div>

      <!-- Follow Us -->
      <div class="border-t border-lfg-black/20 mt-6 pt-6">
        <h3 class="text-center font-bold text-lg mb-4">Follow us</h3>
        <div class="flex justify-center gap-4">
          <a href="https://x.com/lfg_uk" target="_blank" class="bg-lfg-black hover:bg-lfg-black/80 text-white font-bold py-3 px-6 rounded-xl inline-flex items-center gap-3 transition-all hover:scale-105 border-2 border-lfg-black">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            X / Twitter
          </a>
          <a href="https://www.instagram.com/lookingforgrowthuk/" target="_blank" class="bg-gradient-to-r from-purple-500 via-pink-500 to-orange-400 hover:opacity-90 text-white font-bold py-3 px-6 rounded-xl inline-flex items-center gap-3 transition-all hover:scale-105">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
            Instagram
          </a>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="text-center mt-8 text-sm text-lfg-black/50">
      <p>Student loan thresholds and rates from gov.uk. Salary data from <a href="https://www.ons.gov.uk/employmentandlabourmarket/peopleinwork/earningsandworkinghours/datasets/ashe1997to2015selectedestimates" target="_blank" class="underline hover:text-lfg-orange">ONS Data</a>.</p>
      <p class="mt-2 font-bold text-lfg-orange">Built by LFG</p>
    </div>
  </div>

  </div> <!-- Close padding wrapper -->

  <!-- Newsletter Signup Section -->
  <section class="bg-lfg-blue py-12 px-4 md:px-8 border-t-4 border-lfg-black">
    <div class="max-w-md mx-auto text-center mb-8">
      <h2 class="text-3xl md:text-4xl font-black text-lfg-black mb-3">This is not fair.</h2>
      <p class="text-lfg-black/70 text-base">Sign up to our mailing list and join the fight for a fairer deal.</p>
    </div>
    <form class="bg-white w-full max-w-[400px] mx-auto rounded-xl p-8 flex flex-col gap-5 border-2 border-lfg-black shadow-lg" id="nlForm">
      <div class="nl-field flex flex-col gap-2">
        <label for="nlName" class="text-sm font-medium">name*</label>
        <input type="text" id="nlName" name="name" required>
        <span class="nl-error-msg" id="nlNameError">Name is required</span>
      </div>
      <div class="nl-field flex flex-col gap-2">
        <label for="nlEmail" class="text-sm font-medium">email*</label>
        <input type="email" id="nlEmail" name="email" required>
        <span class="nl-error-msg" id="nlEmailError">Invalid email address</span>
      </div>
      <div class="nl-submit-error" id="nlSubmitError">Failed to submit. Please try again.</div>
      <button type="submit" class="nl-btn" id="nlSubmitBtn">join us</button>
    </form>
  </section>

  <!-- Newsletter Success Modal -->
  <div class="nl-modal-overlay" id="nlSuccessModal">
    <div class="bg-white rounded-xl p-8 max-w-[500px] w-full shadow-lg relative">
      <button class="absolute top-3 right-3 p-1 rounded hover:bg-gray-100 transition-colors" id="nlModalClose">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </button>
      <h2 class="text-2xl font-bold text-center mb-4 mt-2">Thank You!</h2>
      <p class="text-center mb-4">Thanks for signing up. We look forward to connecting with you and will be in touch soon!</p>
      <div class="border-t border-lfg-black my-4"></div>
      <p class="text-center font-bold mb-3">Follow us on social media to stay updated:</p>
      <div class="flex gap-5 justify-center mb-4">
        <a href="https://www.instagram.com/lookingforgrowthuk/" target="_blank" rel="noopener noreferrer" class="hover:opacity-70 transition-opacity">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none"><rect width="24" height="24" rx="6" fill="url(#nl-ig)"/><path d="M12 8.75a3.25 3.25 0 1 0 0 6.5 3.25 3.25 0 0 0 0-6.5Z" fill="#fff"/><path d="M16.25 4h-8.5A3.75 3.75 0 0 0 4 7.75v8.5A3.75 3.75 0 0 0 7.75 20h8.5A3.75 3.75 0 0 0 20 16.25v-8.5A3.75 3.75 0 0 0 16.25 4Zm2.5 12.25a2.5 2.5 0 0 1-2.5 2.5h-8.5a2.5 2.5 0 0 1-2.5-2.5v-8.5a2.5 2.5 0 0 1 2.5-2.5h8.5a2.5 2.5 0 0 1 2.5 2.5v8.5Z" fill="#fff"/><circle cx="16.875" cy="7.125" r="0.875" fill="#fff"/><defs><linearGradient id="nl-ig" x1="0" y1="0" x2="24" y2="24" gradientUnits="userSpaceOnUse"><stop stop-color="#f58529"/><stop offset="0.5" stop-color="#dd2a7b"/><stop offset="1" stop-color="#8134af"/></linearGradient></defs></svg>
        </a>
        <a href="https://x.com/lfg_uk" target="_blank" rel="noopener noreferrer" class="hover:opacity-70 transition-opacity">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none"><rect width="24" height="24" rx="6" fill="#000"/><path d="M13.3174 10.7749L18.1677 5H17.0112L12.8193 10.0088L9.48911 5H5.5L10.5911 12.2311L5.5 18.3421H6.65645L11.0886 13.0662L14.6098 18.3421H18.5989L13.3171 10.7749H13.3174ZM11.6686 12.3839L11.1464 11.6366L7.0715 5.87016H8.92964L12.2012 10.5747L12.7234 11.322L17.0117 17.5091H15.1536L11.6686 12.3843V12.3839Z" fill="#fff"/></svg>
        </a>
        <a href="https://www.youtube.com/@LFGrowth" target="_blank" rel="noopener noreferrer" class="hover:opacity-70 transition-opacity">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none"><rect width="24" height="24" rx="6" fill="#FF0000"/><path d="M19.615 8.375a2.12 2.12 0 0 0-1.49-1.5C16.78 6.5 12 6.5 12 6.5s-4.78 0-6.125.375a2.12 2.12 0 0 0-1.49 1.5C4 9.72 4 12.5 4 12.5s0 2.78.385 4.125a2.12 2.12 0 0 0 1.49 1.5C7.22 18.5 12 18.5 12 18.5s4.78 0 6.125-.375a2.12 2.12 0 0 0 1.49-1.5C20 15.28 20 12.5 20 12.5s0-2.78-.385-4.125Z" fill="#fff"/><path d="M10.5 15V10l4 2.5-4 2.5Z" fill="#FF0000"/></svg>
        </a>
      </div>
      <div class="border-t border-lfg-black my-4"></div>
      <p class="text-center mb-4">If you want to help us really push this issue, please consider donating!</p>
      <div class="flex justify-center">
        <a href="https://lookingforgrowth.uk/donate" class="nl-donate-btn">Donate</a>
      </div>
    </div>
  </div>

  <script>
    // Mobile menu toggle
    function toggleMobileMenu() {
      const menu = document.getElementById('mobileMenu');
      menu.classList.toggle('open');
      // Prevent body scroll when menu is open
      document.body.style.overflow = menu.classList.contains('open') ? 'hidden' : '';
    }

    // Share on X function
    function shareOnX(plan) {
      let salary, loanBalance, monthlyRepayment, monthlyInterest, netChange, planName;

      if (plan === 'plan2') {
        salary = currentSalary;
        loanBalance = studentLoanBalance;
        const calc = getCalculations();
        monthlyRepayment = calc.monthlyRepayment;
        monthlyInterest = calc.monthlyInterest;
        netChange = calc.netChange;
        planName = 'Plan 2';
      } else {
        salary = p5CurrentSalary;
        loanBalance = p5StudentLoanBalance;
        const calc = p5GetCalculations();
        monthlyRepayment = calc.monthlyRepayment;
        monthlyInterest = calc.monthlyInterest;
        netChange = calc.netChange;
        planName = 'Plan 5';
      }

      const debtStatus = netChange >= 0 ? 'decreasing' : 'increasing';
      const netChangeAbs = Math.abs(netChange).toFixed(2);

      const tweetText = `My student loan breakdown (${planName}):

Salary: £${salary.toLocaleString()}
Loan Balance: £${loanBalance.toLocaleString()}

Monthly repayment: £${monthlyRepayment.toFixed(2)}
Monthly interest: £${monthlyInterest.toFixed(2)}
My debt is ${debtStatus} by £${netChangeAbs}/month

See how yours compares:`;

      const url = 'https://dashboards.lookingforgrowth.uk/student-loan-calculator.html';
      const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}&url=${encodeURIComponent(url)}`;

      window.open(tweetUrl, '_blank', 'width=550,height=420');
    }

    // Plan navigation functions
    function selectPlan(plan) {
      document.getElementById('selectionMenu').style.display = 'none';

      if (plan === 'plan2') {
        document.getElementById('plan2Content').style.display = 'block';
        document.getElementById('plan5Content').style.display = 'none';
        // Initialize charts if not already done
        if (!barChart) {
          initCharts();
          updateAll();
        }
      } else if (plan === 'plan5') {
        document.getElementById('plan2Content').style.display = 'none';
        document.getElementById('plan5Content').style.display = 'block';
        // Initialize Plan 5 charts if not already done
        if (!p5BarChart) {
          p5InitCharts();
          p5UpdateAll();
        }
      }
    }

    function showMenu() {
      document.getElementById('selectionMenu').style.display = 'block';
      document.getElementById('plan2Content').style.display = 'none';
      document.getElementById('plan5Content').style.display = 'none';
    }

    const COLORS = { orange: '#FE5500', yellow: '#EE9944', blue: '#79CAC4', black: '#000000', cream: '#EBE3D0', red: '#dc2626', purple: '#9333ea' };

    // Plan 2 Student Loan Thresholds
    const REPAYMENT_THRESHOLD = 28470;
    const INTEREST_LOWER_THRESHOLD = 28470;
    const INTEREST_UPPER_THRESHOLD = 51245;
    const INTEREST_RATE_MIN = 0.032;
    const INTEREST_RATE_MAX = 0.062;

    // Plan 5 Student Loan Thresholds
    const P5_REPAYMENT_THRESHOLD = 25000;
    const P5_INTEREST_RATE = 0.032; // Fixed 3.2%
    const P5_WRITE_OFF_YEARS = 40;

    // Tax thresholds (2024/25)
    const TAX_PERSONAL_ALLOWANCE = 12570;
    const TAX_BASIC_RATE_LIMIT = 50270;
    const NI_PRIMARY_THRESHOLD = 12576;
    const NI_UPPER_LIMIT = 50268;

    const salaryGrowthFactors = { year1: 1.0, year10: 1.242, year20: 1.343, year30: 1.283 };
    // Extended growth factors for 40-year projection
    const salaryGrowthFactors40 = { year1: 1.0, year15: 1.242, year25: 1.343, year35: 1.283, year40: 1.20 };

    let currentSalary = 32347;
    let studentLoanBalance = 53000;
    let barChart = null;
    let projectionChart = null;
    let taxChart = null;

    // Plan 5 variables
    let p5CurrentSalary = 32347;
    let p5StudentLoanBalance = 53000;
    let p5BarChart = null;
    let p5ProjectionChart = null;
    let p5TaxChart = null;

    // Tax calculation
    function calculateTax(salary) {
      if (salary <= TAX_PERSONAL_ALLOWANCE) return 0;
      const taxable = Math.min(salary, TAX_BASIC_RATE_LIMIT) - TAX_PERSONAL_ALLOWANCE;
      let tax = taxable * 0.20;
      if (salary > TAX_BASIC_RATE_LIMIT) {
        tax += (salary - TAX_BASIC_RATE_LIMIT) * 0.40;
      }
      return tax;
    }

    // NI calculation
    function calculateNI(salary) {
      if (salary <= NI_PRIMARY_THRESHOLD) return 0;
      const niable = Math.min(salary, NI_UPPER_LIMIT) - NI_PRIMARY_THRESHOLD;
      let ni = niable * 0.08;
      if (salary > NI_UPPER_LIMIT) {
        ni += (salary - NI_UPPER_LIMIT) * 0.02;
      }
      return ni;
    }

    function calculateInterestRate(salary) {
      if (salary <= INTEREST_LOWER_THRESHOLD) return INTEREST_RATE_MIN;
      if (salary >= INTEREST_UPPER_THRESHOLD) return INTEREST_RATE_MAX;
      const progress = (salary - INTEREST_LOWER_THRESHOLD) / (INTEREST_UPPER_THRESHOLD - INTEREST_LOWER_THRESHOLD);
      return INTEREST_RATE_MIN + (progress * (INTEREST_RATE_MAX - INTEREST_RATE_MIN));
    }

    function calculateMonthlyRepayment(salary) {
      if (salary <= REPAYMENT_THRESHOLD) return 0;
      return ((salary - REPAYMENT_THRESHOLD) * 0.09) / 12;
    }

    function calculateAnnualRepayment(salary) {
      if (salary <= REPAYMENT_THRESHOLD) return 0;
      return (salary - REPAYMENT_THRESHOLD) * 0.09;
    }

    function getSalaryForYear(year, startingSalary) {
      if (year <= 1) return startingSalary;
      if (year <= 10) return startingSalary * (1 + ((year - 1) / 9) * (salaryGrowthFactors.year10 - 1));
      if (year <= 20) return startingSalary * (salaryGrowthFactors.year10 + ((year - 10) / 10) * (salaryGrowthFactors.year20 - salaryGrowthFactors.year10));
      if (year <= 30) return startingSalary * (salaryGrowthFactors.year20 + ((year - 20) / 10) * (salaryGrowthFactors.year30 - salaryGrowthFactors.year20));
      return startingSalary * salaryGrowthFactors.year30;
    }

    function getCalculations() {
      const interestRate = calculateInterestRate(currentSalary);
      const monthlyRepayment = calculateMonthlyRepayment(currentSalary);
      const monthlyInterest = (studentLoanBalance * interestRate) / 12;
      return { interestRate, monthlyRepayment, monthlyInterest, netChange: monthlyRepayment - monthlyInterest };
    }

    function calculateFixedSalaryPayoff() {
      const interestRate = calculateInterestRate(currentSalary);
      const monthlyRepayment = calculateMonthlyRepayment(currentSalary);
      const maxMonths = 30 * 12; // 30 years write-off period

      // Always simulate the full 30 years to get totals
      let balance = studentLoanBalance;
      let months = 0;
      let totalPaid = 0;
      let totalInterest = 0;
      let paidOffMonth = null;

      while (months < maxMonths) {
        const monthlyInterest = (balance * interestRate) / 12;
        totalInterest += monthlyInterest;
        balance += monthlyInterest;

        const payment = Math.min(monthlyRepayment, Math.max(0, balance));
        balance -= payment;
        totalPaid += payment;
        months++;

        // Check if paid off
        if (balance < 0.01 && paidOffMonth === null) {
          balance = 0;
          paidOffMonth = months;
          break; // Stop if fully paid off
        }
      }

      // Determine the reason
      let reason, canPayOff;
      if (paidOffMonth !== null) {
        reason = 'paid_off';
        canPayOff = true;
      } else if (monthlyRepayment <= 0) {
        reason = 'below_threshold';
        canPayOff = false;
      } else {
        reason = 'balance_growing';
        canPayOff = false;
      }

      // Calculate equilibrium balance for messaging
      const equilibriumBalance = monthlyRepayment > 0 ? (monthlyRepayment * 12) / interestRate : 0;

      return {
        canPayOff: canPayOff,
        reason: reason,
        equilibriumBalance: equilibriumBalance,
        months: paidOffMonth || maxMonths,
        years: Math.floor((paidOffMonth || maxMonths) / 12),
        remainingMonths: (paidOffMonth || maxMonths) % 12,
        totalPaid: totalPaid,
        totalInterest: totalInterest,
        interestRate: interestRate,
        finalBalance: balance
      };
    }

    function calculate30YearProjection() {
      let balance = studentLoanBalance;
      const yearlyData = [];
      let cumulativeRepaid = 0, cumulativeInterest = 0;
      let cumulativeTax = 0, cumulativeNI = 0;
      
      for (let year = 1; year <= 30; year++) {
        const salary = getSalaryForYear(year, currentSalary);
        const interestRate = calculateInterestRate(salary);
        const annualRepayment = calculateAnnualRepayment(salary);
        const interestThisYear = balance * interestRate;
        const taxThisYear = calculateTax(salary);
        const niThisYear = calculateNI(salary);
        
        cumulativeRepaid += annualRepayment;
        cumulativeInterest += interestThisYear;
        cumulativeTax += taxThisYear;
        cumulativeNI += niThisYear;
        
        balance = Math.max(0, balance + interestThisYear - annualRepayment);
        
        yearlyData.push({ 
          year, salary, balance, 
          cumulativeRepaid, cumulativeInterest, interestRate,
          cumulativeTax, cumulativeNI,
          yearlyTax: taxThisYear, yearlyNI: niThisYear, yearlyRepayment: annualRepayment
        });
      }
      return { 
        yearlyData, 
        totalRepaid: cumulativeRepaid, 
        totalInterest: cumulativeInterest, 
        finalBalance: balance, 
        amountWrittenOff: balance,
        totalTax: cumulativeTax,
        totalNI: cumulativeNI
      };
    }

    function updateAll() {
      const calc = getCalculations();

      // Monthly breakdown
      document.getElementById('monthlyRepayment').textContent = `£${calc.monthlyRepayment.toFixed(2)}`;
      document.getElementById('monthlyInterest').textContent = `£${calc.monthlyInterest.toFixed(2)}`;
      document.getElementById('interestRateLabel').textContent = `Interest rate: ${(calc.interestRate * 100).toFixed(2)}%`;

      let explanation = currentSalary <= INTEREST_LOWER_THRESHOLD
        ? `At £${currentSalary.toLocaleString()}, you're below £28,470, so your rate is the minimum 3.2% (RPI).`
        : currentSalary >= INTEREST_UPPER_THRESHOLD
          ? `At £${currentSalary.toLocaleString()}, you're above £51,245, so your rate is the maximum 6.2% (RPI+3%).`
          : `At £${currentSalary.toLocaleString()}, you're between the thresholds, so your rate is ${(calc.interestRate * 100).toFixed(2)}% (scaled).`;
      document.getElementById('interestRateExplanation').textContent = explanation;

      const netChangeEl = document.getElementById('netChange');
      const netChangeLabelEl = document.getElementById('netChangeLabel');
      const warningBox = document.getElementById('warningBox');
      const successBox = document.getElementById('successBox');

      if (calc.netChange >= 0) {
        netChangeEl.textContent = `-£${calc.netChange.toFixed(2)}`;
        netChangeEl.className = 'text-2xl font-black text-lfg-blue';
        netChangeLabelEl.textContent = 'Debt decreasing';
        warningBox.style.display = 'none';
        successBox.style.display = 'flex';
        document.getElementById('successText').textContent = `Your repayments (£${calc.monthlyRepayment.toFixed(2)}/month) exceed the interest (£${calc.monthlyInterest.toFixed(2)}/month).`;
      } else {
        netChangeEl.textContent = `+£${Math.abs(calc.netChange).toFixed(2)}`;
        netChangeEl.className = 'text-2xl font-black text-lfg-orange';
        netChangeLabelEl.textContent = 'Debt increasing';
        warningBox.style.display = 'flex';
        successBox.style.display = 'none';
        document.getElementById('warningText').textContent = `At your current salary, the interest added (£${calc.monthlyInterest.toFixed(2)}/month) exceeds your repayments (£${calc.monthlyRepayment.toFixed(2)}/month).`;
      }

      // Update charts
      if (barChart) {
        barChart.data.datasets[0].data = [calc.monthlyRepayment];
        barChart.data.datasets[1].data = [calc.monthlyInterest];
        barChart.update();
      }
    }

    // ==================== PLAN 5 FUNCTIONS ====================

    function p5CalculateMonthlyRepayment(salary) {
      if (salary <= P5_REPAYMENT_THRESHOLD) return 0;
      return ((salary - P5_REPAYMENT_THRESHOLD) * 0.09) / 12;
    }

    function p5CalculateAnnualRepayment(salary) {
      if (salary <= P5_REPAYMENT_THRESHOLD) return 0;
      return (salary - P5_REPAYMENT_THRESHOLD) * 0.09;
    }

    function p5GetSalaryForYear(year, startingSalary) {
      // Extended salary progression for 40 years
      if (year <= 1) return startingSalary;
      if (year <= 15) return startingSalary * (1 + ((year - 1) / 14) * (salaryGrowthFactors40.year15 - 1));
      if (year <= 25) return startingSalary * (salaryGrowthFactors40.year15 + ((year - 15) / 10) * (salaryGrowthFactors40.year25 - salaryGrowthFactors40.year15));
      if (year <= 35) return startingSalary * (salaryGrowthFactors40.year25 + ((year - 25) / 10) * (salaryGrowthFactors40.year35 - salaryGrowthFactors40.year25));
      if (year <= 40) return startingSalary * (salaryGrowthFactors40.year35 + ((year - 35) / 5) * (salaryGrowthFactors40.year40 - salaryGrowthFactors40.year35));
      return startingSalary * salaryGrowthFactors40.year40;
    }

    function p5GetCalculations() {
      const monthlyRepayment = p5CalculateMonthlyRepayment(p5CurrentSalary);
      const monthlyInterest = (p5StudentLoanBalance * P5_INTEREST_RATE) / 12;
      return { interestRate: P5_INTEREST_RATE, monthlyRepayment, monthlyInterest, netChange: monthlyRepayment - monthlyInterest };
    }

    function p5CalculateFixedSalaryPayoff() {
      const monthlyRepayment = p5CalculateMonthlyRepayment(p5CurrentSalary);
      const maxMonths = P5_WRITE_OFF_YEARS * 12; // 40 years write-off period

      // Always simulate the full 40 years to get totals
      let balance = p5StudentLoanBalance;
      let months = 0;
      let totalPaid = 0;
      let totalInterest = 0;
      let paidOffMonth = null;

      while (months < maxMonths) {
        const monthlyInterest = (balance * P5_INTEREST_RATE) / 12;
        totalInterest += monthlyInterest;
        balance += monthlyInterest;

        const payment = Math.min(monthlyRepayment, Math.max(0, balance));
        balance -= payment;
        totalPaid += payment;
        months++;

        // Check if paid off
        if (balance < 0.01 && paidOffMonth === null) {
          balance = 0;
          paidOffMonth = months;
          break; // Stop if fully paid off
        }
      }

      // Determine the reason
      let reason, canPayOff;
      if (paidOffMonth !== null) {
        reason = 'paid_off';
        canPayOff = true;
      } else if (monthlyRepayment <= 0) {
        reason = 'below_threshold';
        canPayOff = false;
      } else {
        reason = 'balance_growing';
        canPayOff = false;
      }

      // Calculate equilibrium balance for messaging
      const equilibriumBalance = monthlyRepayment > 0 ? (monthlyRepayment * 12) / P5_INTEREST_RATE : 0;

      return {
        canPayOff: canPayOff,
        reason: reason,
        equilibriumBalance: equilibriumBalance,
        months: paidOffMonth || maxMonths,
        years: Math.floor((paidOffMonth || maxMonths) / 12),
        remainingMonths: (paidOffMonth || maxMonths) % 12,
        totalPaid: totalPaid,
        totalInterest: totalInterest,
        finalBalance: balance
      };
    }

    function p5Calculate40YearProjection() {
      let balance = p5StudentLoanBalance;
      const yearlyData = [];
      let cumulativeRepaid = 0, cumulativeInterest = 0;
      let cumulativeTax = 0, cumulativeNI = 0;

      for (let year = 1; year <= P5_WRITE_OFF_YEARS; year++) {
        const salary = p5GetSalaryForYear(year, p5CurrentSalary);
        const annualRepayment = p5CalculateAnnualRepayment(salary);
        const interestThisYear = balance * P5_INTEREST_RATE;
        const taxThisYear = calculateTax(salary);
        const niThisYear = calculateNI(salary);

        cumulativeRepaid += annualRepayment;
        cumulativeInterest += interestThisYear;
        cumulativeTax += taxThisYear;
        cumulativeNI += niThisYear;

        balance = Math.max(0, balance + interestThisYear - annualRepayment);

        yearlyData.push({
          year, salary, balance,
          cumulativeRepaid, cumulativeInterest,
          cumulativeTax, cumulativeNI,
          yearlyTax: taxThisYear, yearlyNI: niThisYear, yearlyRepayment: annualRepayment
        });
      }
      return {
        yearlyData, totalRepaid: cumulativeRepaid, totalInterest: cumulativeInterest,
        finalBalance: balance, amountWrittenOff: balance,
        totalTax: cumulativeTax, totalNI: cumulativeNI
      };
    }

    function p5UpdateAll() {
      const calc = p5GetCalculations();

      // Monthly breakdown
      document.getElementById('p5-monthlyRepayment').textContent = `£${calc.monthlyRepayment.toFixed(2)}`;
      document.getElementById('p5-monthlyInterest').textContent = `£${calc.monthlyInterest.toFixed(2)}`;

      const netChangeEl = document.getElementById('p5-netChange');
      const netChangeLabelEl = document.getElementById('p5-netChangeLabel');
      const warningBox = document.getElementById('p5-warningBox');
      const successBox = document.getElementById('p5-successBox');

      if (calc.netChange >= 0) {
        netChangeEl.textContent = `-£${calc.netChange.toFixed(2)}`;
        netChangeEl.className = 'text-2xl font-black text-lfg-blue';
        netChangeLabelEl.textContent = 'Debt decreasing';
        warningBox.style.display = 'none';
        successBox.style.display = 'flex';
        document.getElementById('p5-successText').textContent = `Your repayments (£${calc.monthlyRepayment.toFixed(2)}/month) exceed the interest (£${calc.monthlyInterest.toFixed(2)}/month).`;
      } else {
        netChangeEl.textContent = `+£${Math.abs(calc.netChange).toFixed(2)}`;
        netChangeEl.className = 'text-2xl font-black text-lfg-orange';
        netChangeLabelEl.textContent = 'Debt increasing';
        warningBox.style.display = 'flex';
        successBox.style.display = 'none';
        document.getElementById('p5-warningText').textContent = `At your current salary, the interest added (£${calc.monthlyInterest.toFixed(2)}/month) exceeds your repayments (£${calc.monthlyRepayment.toFixed(2)}/month).`;
      }

      // Update charts
      if (p5BarChart) {
        p5BarChart.data.datasets[0].data = [calc.monthlyRepayment];
        p5BarChart.data.datasets[1].data = [calc.monthlyInterest];
        p5BarChart.update();
      }
    }

    function p5InitCharts() {
      const calc = p5GetCalculations();

      // Monthly bar chart
      p5BarChart = new Chart(document.getElementById('p5-barChart').getContext('2d'), {
        type: 'bar',
        data: {
          labels: ['Monthly Comparison'],
          datasets: [
            { label: 'Your Repayment', data: [calc.monthlyRepayment], backgroundColor: COLORS.blue, borderColor: COLORS.black, borderWidth: 2, borderRadius: 6 },
            { label: 'Interest Added', data: [calc.monthlyInterest], backgroundColor: COLORS.orange, borderColor: COLORS.black, borderWidth: 2, borderRadius: 6 }
          ]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: { legend: { position: 'bottom', labels: { color: COLORS.black, padding: 15, usePointStyle: true, font: { family: 'DM Sans', weight: 'bold' } } }, tooltip: { callbacks: { label: ctx => `${ctx.dataset.label}: £${ctx.raw.toFixed(2)}` } } },
          scales: { x: { grid: { display: false }, ticks: { color: COLORS.black } }, y: { grid: { color: COLORS.black + '20' }, ticks: { color: COLORS.black, callback: v => '£' + v } } }
        }
      });
    }

    // ==================== PLAN 2 FUNCTIONS ====================

    function initCharts() {
      const calc = getCalculations();

      // Monthly bar chart
      barChart = new Chart(document.getElementById('barChart').getContext('2d'), {
        type: 'bar',
        data: {
          labels: ['Monthly Comparison'],
          datasets: [
            { label: 'Your Repayment', data: [calc.monthlyRepayment], backgroundColor: COLORS.blue, borderColor: COLORS.black, borderWidth: 2, borderRadius: 6 },
            { label: 'Interest Added', data: [calc.monthlyInterest], backgroundColor: COLORS.orange, borderColor: COLORS.black, borderWidth: 2, borderRadius: 6 }
          ]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: { legend: { position: 'bottom', labels: { color: COLORS.black, padding: 15, usePointStyle: true, font: { family: 'DM Sans', weight: 'bold' } } }, tooltip: { callbacks: { label: ctx => `${ctx.dataset.label}: £${ctx.raw.toFixed(2)}` } } },
          scales: { x: { grid: { display: false }, ticks: { color: COLORS.black } }, y: { grid: { color: COLORS.black + '20' }, ticks: { color: COLORS.black, callback: v => '£' + v } } }
        }
      });
    }

    // Event listeners - Plan 2
    document.getElementById('salarySlider').addEventListener('input', e => { currentSalary = parseInt(e.target.value); document.getElementById('salaryInput').value = currentSalary; updateAll(); });
    document.getElementById('salaryInput').addEventListener('change', e => { currentSalary = parseInt(e.target.value) || 20000; document.getElementById('salarySlider').value = Math.min(Math.max(currentSalary, 20000), 80000); updateAll(); });
    document.getElementById('loanSlider').addEventListener('input', e => { studentLoanBalance = parseInt(e.target.value); document.getElementById('loanInput').value = studentLoanBalance; updateAll(); });
    document.getElementById('loanInput').addEventListener('change', e => { studentLoanBalance = parseInt(e.target.value) || 0; document.getElementById('loanSlider').value = Math.min(Math.max(studentLoanBalance, 0), 100000); updateAll(); });

    // Event listeners - Plan 5
    document.getElementById('p5-salarySlider').addEventListener('input', e => { p5CurrentSalary = parseInt(e.target.value); document.getElementById('p5-salaryInput').value = p5CurrentSalary; p5UpdateAll(); });
    document.getElementById('p5-salaryInput').addEventListener('change', e => { p5CurrentSalary = parseInt(e.target.value) || 20000; document.getElementById('p5-salarySlider').value = Math.min(Math.max(p5CurrentSalary, 20000), 80000); p5UpdateAll(); });
    document.getElementById('p5-loanSlider').addEventListener('input', e => { p5StudentLoanBalance = parseInt(e.target.value); document.getElementById('p5-loanInput').value = p5StudentLoanBalance; p5UpdateAll(); });
    document.getElementById('p5-loanInput').addEventListener('change', e => { p5StudentLoanBalance = parseInt(e.target.value) || 0; document.getElementById('p5-loanSlider').value = Math.min(Math.max(p5StudentLoanBalance, 0), 100000); p5UpdateAll(); });

    // Don't auto-initialize - wait for user to select a plan
    // document.addEventListener('DOMContentLoaded', () => { initCharts(); updateAll(); });

    // ==================== NEWSLETTER SIGNUP ====================
    (function() {
      const NL_WEBHOOK = 'https://hooks.zapier.com/hooks/catch/24440311/ursog2a/';
      const NL_LIST_ID = '56';
      const nlForm = document.getElementById('nlForm');
      const nlName = document.getElementById('nlName');
      const nlEmail = document.getElementById('nlEmail');
      const nlNameError = document.getElementById('nlNameError');
      const nlEmailError = document.getElementById('nlEmailError');
      const nlSubmitError = document.getElementById('nlSubmitError');
      const nlSubmitBtn = document.getElementById('nlSubmitBtn');
      const nlModal = document.getElementById('nlSuccessModal');
      const nlModalClose = document.getElementById('nlModalClose');

      function nlClearErrors() {
        nlName.classList.remove('nl-error');
        nlEmail.classList.remove('nl-error');
        nlNameError.classList.remove('show');
        nlEmailError.classList.remove('show');
        nlSubmitError.classList.remove('show');
      }

      nlForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        nlClearErrors();
        const name = nlName.value.trim();
        const email = nlEmail.value.trim();
        let hasError = false;

        if (!name) { nlName.classList.add('nl-error'); nlNameError.textContent = 'Name is required'; nlNameError.classList.add('show'); hasError = true; }
        if (!email) { nlEmail.classList.add('nl-error'); nlEmailError.textContent = 'Email is required'; nlEmailError.classList.add('show'); hasError = true; }
        else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { nlEmail.classList.add('nl-error'); nlEmailError.textContent = 'Invalid email address'; nlEmailError.classList.add('show'); hasError = true; }
        if (hasError) return;

        nlSubmitBtn.disabled = true;
        nlSubmitBtn.textContent = 'submitting...';
        try {
          const payload = new URLSearchParams({ 'Name': name, 'Email': email, 'List ID(s)': NL_LIST_ID });
          const res = await fetch(NL_WEBHOOK, { method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body: payload.toString() });
          if (!res.ok) throw new Error('Failed');
          nlName.value = ''; nlEmail.value = '';
          nlModal.classList.add('show');
        } catch (err) {
          console.error('Newsletter signup error:', err);
          nlSubmitError.classList.add('show');
        } finally {
          nlSubmitBtn.disabled = false;
          nlSubmitBtn.textContent = 'join us';
        }
      });

      nlModalClose.addEventListener('click', () => nlModal.classList.remove('show'));
      nlModal.addEventListener('click', (e) => { if (e.target === nlModal) nlModal.classList.remove('show'); });
      nlName.addEventListener('input', () => { nlName.classList.remove('nl-error'); nlNameError.classList.remove('show'); });
      nlEmail.addEventListener('input', () => { nlEmail.classList.remove('nl-error'); nlEmailError.classList.remove('show'); });
    })();
  </script>
</body>
</html>
